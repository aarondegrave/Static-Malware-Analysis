import sys
import math
import argparse
import os


"""Credit to a contributor on code.activestate.com wrote a python program called file_entropy.py"""
"""Most of the contents of this file are not my own."""
"""The original program was written in Python2 so I had to rework the code some and make it work for my program."""
"""If the original author has an issue with me using it please contact me and I will take it down."""


def entropy(input_malware):
    # read the whole file into a byte array
    malware_files = input_malware
    malware = str(malware_files)
    f = open(malware, "rb")
    byteArr = list(f.read())
    f.close()
    fileSize = len(byteArr)
    print ('File size in bytes:')
    print (fileSize)

    # calculate the frequency of each byte value in the file
    freqList = []
    for b in range(256):
        ctr = 0
        for byte in byteArr:
            if byte == b:
                ctr += 1
        freqList.append(float(ctr) / fileSize)
    print ('Frequencies of each byte-character:')
    print (freqList)


    # Shannon entropy
    ent = 0.0
    for freq in freqList:
        if freq > 0:
            ent = ent + freq * math.log(freq, 2)
    ent = -ent
    print ('Shannon entropy (min bits per byte-character):')
    print (ent)
    print ('Min possible file size assuming max theoretical compression efficiency:')
    print((ent * fileSize), 'in bits')
    print((ent * fileSize) / 8, 'in bytes')

parser = argparse.ArgumentParser()
parser.add_argument("--malware", help="Point me to a directory", type=str)
parser.add_argument("--fuzzy", help="Fuzzy hash comparison.", action="store_true")
parser.add_argument("--remove", help="Removes data from files.", action="store_true")
parser.add_argument("--rules",
                    help="Point me to a directory with the yara rules.",
                    type=str)
parser.add_argument("--prefetch", help="Point me to prefetch directory", type=str)
args = parser.parse_args()
