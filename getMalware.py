import wget
import requests
from bs4 import BeautifulSoup
import os
import zipfile
import shutil


def downloadMalware():

  try:
      os.mkdir('/home/kali/Downloads/malware_samples')
  except FileExistsError:
      print("File exists")
  os.chdir('/home/kali/Downloads/malware_samples/')
  websites = []
  webpages = ['https://mb-api.abuse.ch/downloads/']


  for webpage in webpages:
    a = requests.get(webpage)
    soup = BeautifulSoup(a.text, 'html.parser')

    for link in soup.findAll('a'):
      c = (link.get('href'))
      realwebsite = webpage + c
      websites.append(realwebsite)

    for website in websites:
      if website.endswith('.zip'):
        wget.download(website)

      test = os.listdir('/home/kali/Downloads/malware_samples/')

      for filename in test:
        if filename.endswith('.zip'):
          password = 'infected'
          with zipfile.ZipFile(filename) as file:
            file.extractall(pwd=bytes(password, 'utf-8'))
        try:
          if filename.endswith('.zip'):
            os.remove(filename)
        except shutil.Error:
          None




downloadMalware()