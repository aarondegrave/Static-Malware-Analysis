__author__= "Aaron DeGrave"
from malwarecheck import *
import tkinter as tk
from tkinter import *
from tkinter.ttk import *
from tkinter.filedialog import askopenfile
from tkinter.filedialog import askdirectory
import os
import time
import csv
root = Tk()
root.title=("MalwareCheck")

def open_file():
    filename = askopenfile(mode='r', filetypes=[('executable files', '*.exe')])
    if filename.name is not None:
        getmalwaresignature(filename.name)
    if yaravalue.get()== True:
        yara_folder = yara()
        yara_matches(yara_folder,filename.name)
def open_folder():
    malware_folder = askdirectory()
    if yaravalue.get() == True:
        yara_folder = yara()
        yara_matches(yara_folder, malware_folder)
    getmalwaresignature(malware_folder)
    try:
        if fuzzyvalue.get() == True:
            fuzzyhashcompare()
        else:
            print("Testing")
    except KeyError:
        print("End of file")

def yara():
    yara_folder = askdirectory()
    return yara_folder



def remove():
    dir = os.listdir()
    for file in dir:
        if file.endswith('.json'):
            os.remove(file)
    for file in dir:
        if file.endswith('.csv'):
            os.remove(file)
def fuzzyhash():
    fuzzyhash = open("fuzzyhashlist.csv", "w")
    with fuzzyhash:
        fields = ['FILENAME', 'FUZZYHASH']
        writer = csv.DictWriter(fuzzyhash, fieldnames=fields)
        writer.writeheader()

root.geometry("300x300")
frame = Frame(root,width=300, height=300)
frame.pack()
btn = Button(master=frame, text='Open')
btn2 = Button(master=frame, text='Open Folder', command=lambda:open_folder())
removecheck = Checkbutton(master=frame, text='Remove Old Data', command = lambda :remove())
fuzzyvalue = tk.BooleanVar()
fuzzyvalue.set(True)
fuzzycheck = Checkbutton(master=frame, text="Fuzzy hash compare", command= lambda :fuzzyhash(), var=fuzzyvalue)
yaravalue = tk.BooleanVar()
yaravalue.set(True)
yaracheck = Checkbutton(master=frame, text = "Yara Rules" , var=yaravalue)
btn.config(command=lambda : open_file())
btn.pack(side=TOP)
btn2.pack(side=TOP)
removecheck.pack(side=TOP)
fuzzycheck.pack(side=TOP)
yaracheck.pack(side=TOP)

mainloop()

